{% extends 'dashboard/base_index/base.html' %}
{% load static %}
{% block title %}
{% if form.initial %}
Update Rent
{% else %}
Add Rent
{% endif %}
{% endblock %}
{% block body %}
<link href="{% static 'dashboard/build/css/bootstrap.min.css'%}" id="bootstrap-style" rel="stylesheet" type="text/css" />
<link href="{% static 'dashboard/build/css/icons.min.css'%}" rel="stylesheet" type="text/css" />
<link href="{% static 'dashboard/build/css/app.min.css'%}" id="app-style" rel="stylesheet" type="text/css" />

<style>
    #field_list {
        list-style-type: none;
        padding-left: 0;
    }
    #id_hostingName,#id_category ,#id_products-0-image{
        width: 100%;
        padding: 8px;
        border: 1px solid #CED4DA;
        border-radius: 4px;
        box-sizing: border-box;
    }
    [id^="id_rentfields-"]:not([id$="-DELETE"]) {
        width: 100%;
        padding: 8px;
        border: 1px solid #CED4DA;
        border-radius: 4px;
        box-sizing: border-box;
    }

    
    [id^="id_rentfields-"]:not([id$="-DELETE"]) {
        width: 100%;
        padding: 8px;
        border: 1px solid #CED4DA;
        border-radius: 4px;
        box-sizing: border-box;
    }
    [id^="id_rents-"]:not([id$="-DELETE"]) {
        width: 100%;
        padding: 8px;
        border: 1px solid #CED4DA;
        border-radius: 4px;
        box-sizing: border-box;
    }
    
    input[type="checkbox"][name^="rent-"] {
        width: auto; /* Keep checkbox its default size */
        height: auto; /* Ensure the checkbox retains its default height */
        padding: 8px; /* Add padding around the checkbox */
        border: 1px solid #CED4DA; /* Add a border similar to other inputs */
        border-radius: 4px; /* Add border radius to make it look rounded */
        box-sizing: border-box; /* Ensure padding and border are included in the element's total width and height */
        margin-right: 8px; /* Add space to the right for better spacing */
        cursor: pointer; /* Change the cursor to pointer to indicate it's clickable */
    }
    
    
</style>
<!-- ============================================================== -->
<!-- Start right Content here -->
<!-- ============================================================== -->
<div class="main-content">
    <div class="page-content">
        <!-- Start content -->
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="page-title-box d-flex align-items-center justify-content-between">
                        <a href="{% url  'dashboard:Rent' %}" class="btn btn-primary">Back to rental property list </a>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-lg-12">
                    <div class="card">
                        <div class="card-body">
                            <blockquote> {% if form.initial %} Update {% else %}Add New {% endif %} Rental Property </blockquote>
                            <form  method="post" enctype="multipart/form-data">
                                {% csrf_token %}
                                {{ rent_form.media }}
                                {{rent_form.errors}}
                                {% if messages %}
                                {% for msg in messages %}
                                <div class="alert alert-{{ msg.tags }} alert-dismissible text-bg-{{ msg.tags }} border-0 fade show"
                                    role="alert">
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert"
                                        aria-label="Close"></button>
                                    <strong>{% if msg.tags == 'success' %}Success{% elif msg.tags == 'warning' %}Warning{% endif %} -
                                    </strong>{{ msg.message }}
                                </div>
                                {% endfor %}
                                {% endif %}
                                <div class="row">
                                    <div class="col-xl-6">
                                        <div class="mb-3">
                                            <label class="form-label">Category Name</label>
                                            {{rent_form.category}}
                                        </div>

                                        <div class="mb-3">
                                            <label for="{{ rent_form.title.id_for_label }}" class="form-label">Title</label>
                                            <input type="text" name=" {{ rent_form.title.name }}" id="{{ rent_form.title.id_for_label }}" class="form-control" required
                                                value="{% if rent_form.instance %}{{ rent_form.instance.title }}{% endif %}" placeholder="Enter name of rental property">
                                        </div>

<!--                                        <div class="mb-3">-->
<!--&lt;!&ndash;                                            <label for="{{ rent_form.location.id_for_label }}" class="form-label">location</label>&ndash;&gt;-->
<!--                                            <input type="text" name=" {{ rent_form.location.name }}" id="{{ rent_form.location.id_for_label }}" class="form-control" required-->
<!--                                                value="{% if rent_form.instance %}{{ rent_form.instance.location }}{% endif %}" placeholder="Enter location">-->
<!--                                        </div>-->

                                        <div class="mb-3">
                                            <label for="{{ rent_form.product_image.id_for_label }}" class="form-label">Main Image :</label>
                                            <input type="file" name="{{ rent_form.product_image.name }}" id="{{ rent_form.product_image.id_for_label }}" class="form-control" required onchange="showPreview(this);">
                                            <div id="product_imageContainer" style="width:auto; height:auto;">
                                                {% if rent_form.instance and rent_form.instance.product_image %}
                                                    <img class="img-fluid" id="product_imagePreview" src="{{ rent_form.instance.product_image.url }}" alt="">
                                                {% else %}
                                                    <img class="img-fluid" id="product_imagePreview" src="" alt="">
                                                {% endif %}
                                            </div>
                                        </div>

                                    <div class="mb-3">
                                        <label for="{{ rent_form.video.id_for_label }}" class="form-label">Video :</label>
                                        <input type="file" name="{{ rent_form.video.name }}" id="{{ rent_form.video.id_for_label }}" class="form-control" onchange="showPreview(this);">
                                        <div id="product_videoContainer" style="width:auto; height:auto;">
                                            {% if rent_form.instance and rent_form.instance.video %}
                                                <video class="img-fluid" id="product_videoPreview" controls>
                                                    <source src="{{ rent_form.instance.video.url }}" type="video/mp4">
                                                    Your browser does not support the video tag.
                                                </video>
                                            {% else %}
                                                <video class="img-fluid" id="product_videoPreview" controls style="display: none;">
                                                    <source src="" type="video/mp4">
                                                    Your browser does not support the video tag.
                                                </video>
                                            {% endif %}
                                        </div>
                                    </div>


                                    <div class="mb-3">
                                        <label for="{{ rent_form.price.id_for_label }}" class="form-label">Price</label>
                                        <input type="number" name=" {{ rent_form.price.name }}" id="{{ rent_form.price.id_for_label }}" class="form-control" required
                                            value="{% if rent_form.instance %}{{ rent_form.instance.price }}{% endif %}" placeholder="Enter price">
                                    </div>


                                    </div>

                                    
                                    <div class="col-lg-6">
                                        <div class="mb-3">
                                            <label class="form-label">Description</label>
                                            {{rent_form.short_descriptions}}
                                        </div>


                                    </div>

                                    

                                </div> 

                                <div class="row">
                                    <div class="col-xl-12">
                                        <h3 style="margin-bottom: 30px;">Add more images:</h3>
                                        <div id="field_list" >
                                            {{ formset.management_form }}
                                            {% for form in formset %}
                                                    {{ form.as_p }}
                                            {% endfor %}
                                        </div>
                                        <button type="button" class="btn btn-secondary" style="margin-bottom:20px;"  id="add_field_button">Add Field</button>
                                    </div>

                                </div>
                                <!-- end row-->
                                <div class="col-auto">
                                    
                                    {% if rent_form.initial %}
                                        <button type="submit" class="btn btn-success chat-send waves-effect waves-light">Add Property</button>
                                    {% else %}
                                        <button type="submit" class="btn btn-primary chat-send waves-effect waves-light">Update Property </button>
                                    {% endif %}
                                    {% comment %} <a href="{% url  'dashboard:product_category' %}" class="btn btn-danger">Back to Category </a> {% endcomment %}
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- end row -->
        </div> <!-- content -->
    </div>
    <style>
        select {
            word-wrap: normal;
            width: 567px;
            height: 40px;
            display: flex;
            border: 1px solid #ccc;
        }
        </style>
        <style>
            #imageContainer {
                max-width: 100%;
                max-height: 80%;
                border: 1px solid #ccc;
                display: flex;
                align-items: center;
                justify-content: center;
                overflow: hidden;
            }

            #imagePreview {
                max-width: 100%;
                max-height: 100%;
            }
        </style>
        <script>
            function showPreview(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('imagePreview').src = e.target.result;
                    };
                    reader.readAsDataURL(input.files[0]);
                }
            }

            function showPreview1(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('imagePreview1').src = e.target.result;
                    };
                    reader.readAsDataURL(input.files[0]);
                }
            }
        </script>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

        <script>
            function validatePassword1() {
                const password1 = document.getElementById('{{ user_form.password1.id_for_label }}').value;
                const password2 = document.getElementById('{{ user_form.password2.id_for_label }}').value;
        
                // Check if passwords match
                if (password1 !== password2) {
                    document.getElementById('password-message1').innerText = 'Passwords do not match.';
                    return;
                }
        
                // Check if password contains both numbers and alphabetic characters until it reaches 8 characters
                if (password1.length < 8 || (!/\d/.test(password1) || !/[a-zA-Z]/.test(password1))) {
                    document.getElementById('password-message1').innerText = 'Password should contain both numbers and alphabetic characters and be at least 8 characters long.';
                    return;
                }
        
                // Check for similarity with other personal information
                const personalInfo = ['username', 'email', 'name']; // Example personal information
                for (const info of personalInfo) {
                    if (password1.toLowerCase().includes(info.toLowerCase())) {
                        document.getElementById('password-message1').innerText = 'Password can\'t be too similar to your other personal information.';
                        return;
                    }
                }
        
                // Check for common passwords
                const commonPasswords = ['password', '123456', 'qwerty']; // Example common passwords
                if (commonPasswords.includes(password1.toLowerCase())) {
                    document.getElementById('password-message1').innerText = 'Password can\'t be a commonly used password.';
                    return;
                }
        
                // Check if password is entirely numeric
                if (/^\d+$/.test(password1)) {
                    document.getElementById('password-message1').innerText = 'Password can\'t be entirely numeric.';
                    return;
                }
        
                document.getElementById('password-message1').innerText = '';
            }
        
            
            function togglePasswordVisibility(inputId) {
                const input = document.getElementById(inputId);
                const eyeIcon = document.getElementById('eye-icon-' + inputId.split('-').pop());
        
                if (input.type === "password") {
                    input.type = "text";
                    eyeIcon.classList.remove('bi-eye');
                    eyeIcon.classList.add('bi-eye-slash');
                } else {
                    input.type = "password";
                    eyeIcon.classList.remove('bi-eye-slash');
                    eyeIcon.classList.add('bi-eye');
                }
            }
        </script>
        <script>
            function validatePassword(input) {
                const password = input.value;
                const email = document.getElementById('{{ user_form.email.id_for_label }}').value;
        
                // Check if password contains both numbers and alphabetic characters
                if (!/\d/.test(password) || !/[a-zA-Z]/.test(password) || password.length < 8) {
                    document.getElementById('password-message').innerText = 'Password should contain both numbers and alphabetic characters, and be at least 8 characters long.';
                    return;
                }
        
                // Check for similarity with other personal information
                const personalInfo = ['username', 'email', 'name']; // Example personal information
                for (const info of personalInfo) {
                    if (password.toLowerCase().includes(info.toLowerCase())) {
                        document.getElementById('password-message').innerText = 'Password can\'t be too similar to your other personal information.';
                        return;
                    }
                }
        
                // Check for common passwords
                const commonPasswords = ['password', '123456', 'qwerty']; // Example common passwords
                if (commonPasswords.includes(password.toLowerCase())) {
                    document.getElementById('password-message').innerText = 'Password can\'t be a commonly used password.';
                    return;
                }
        
                // Check if password is similar to email
                if (password.toLowerCase().includes(email.split('@')[0].toLowerCase()) || password.toLowerCase().includes(email.split('@')[1].toLowerCase())) {
                    document.getElementById('password-message').innerText = 'Password can\'t be too similar to your email.';
                    return;
                }
        
                document.getElementById('password-message').innerText = '';
            }
        </script>

        {% comment %}Add image Field {% endcomment %}
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                document.getElementById('add_field_button').addEventListener('click', function() {
                    var formsetPrefix = '{{ formset.prefix }}';
                    var totalForms = parseInt(document.getElementById('id_' + formsetPrefix + '-TOTAL_FORMS').value);
                    var newFieldIndex = totalForms;  // Index of the new field form
                    var fieldList = document.getElementById('field_list');
                    var newFieldForm = document.createElement('div');
                    newFieldForm.className = 'form-row mb-3'; // Add class for styling
                    // Replace '__prefix__' in the formset HTML with the new index
                    var newFormsetHtml = '{{ formset.empty_form|escapejs }}'.replace(/__prefix__/g, newFieldIndex);
                    newFieldForm.innerHTML = newFormsetHtml;
                    fieldList.appendChild(newFieldForm);
                    // Update the TOTAL_FORMS count
                    document.getElementById('id_' + formsetPrefix + '-TOTAL_FORMS').value = totalForms + 1;
                });
            });
            </script>
    
    {%endblock%}